Failed to initialize SMA calculator: IBKR connection must be connected before creating SMACalculator
INFO - Logging initialized: /Users/karthik/projects/DayTrader/trader/backtest/logs/backtest_20250915_170314.log
INFO - ================================================================================
INFO - PS60 BACKTEST - 2025-09-15 00:00:00
INFO - ================================================================================
INFO - Scanner file: /Users/karthik/projects/DayTrader/stockscanner/output/scanner_results_20250915.json
INFO - TSLA: Fetched 4680 5-second bars

================================================================================
PS60 BACKTEST - 2025-09-15 00:00:00
================================================================================
Scanner file: /Users/karthik/projects/DayTrader/stockscanner/output/scanner_results_20250915.json
Loaded 57 scanner results
‚úì Connected to IBKR (Client ID: 3000)
‚ö†Ô∏è  Using LEGACY scoring filtering

================================================================================
MARKET TREND: NEUTRAL
WATCHLIST: 52 tradeable setups (using strategy filters)
================================================================================

üìä Pre-fetching hourly bars for momentum indicators...
  ‚úì TSLA: 50 hourly bars cached
  ‚úì LYFT: 50 hourly bars cached
  ‚úì JD: 50 hourly bars cached
  ‚úì MU: 50 hourly bars cached
  ‚úì ARM: 50 hourly bars cached
  ‚úì BIDU: 50 hourly bars cached
  ‚úì HOOD: 50 hourly bars cached
  ‚úì LCID: 50 hourly bars cached
  ‚úì RIVN: 50 hourly bars cached
  ‚úì CLOV: 50 hourly bars cached
  ‚úì NIO: 50 hourly bars cached
  ‚úì COIN: 50 hourly bars cached
  ‚úì BA: 50 hourly bars cached
  ‚úì INTC: 50 hourly bars cached
  ‚úì XPEV: 50 hourly bars cached
  ‚úì AMD: 50 hourly bars cached
  ‚úì RBLX: 50 hourly bars cached
  ‚úì LRCX: 50 hourly bars cached
  ‚úì UBER: 50 hourly bars cached
  ‚úì ROKU: 50 hourly bars cached
  ‚úì NVDA: 50 hourly bars cached
  ‚úì SOFI: 50 hourly bars cached
  ‚úì AVGO: 50 hourly bars cached
  ‚úì GS: 50 hourly bars cached
  ‚úì BB: 50 hourly bars cached
  ‚úì AAPL: 50 hourly bars cached
  ‚úì SNAP: 50 hourly bars cached
  ‚úì GOOGL: 50 hourly bars cached
  ‚úì XOM: 50 hourly bars cached
  ‚úì AMC: 50 hourly bars cached
  ‚úì LI: 50 hourly bars cached
  ‚úì BBBY: 50 hourly bars cached
  ‚úì DIS: 50 hourly bars cached
  ‚úì F: 50 hourly bars cached
  ‚úì PYPL: 50 hourly bars cached
  ‚úì AMAT: 50 hourly bars cached
  ‚úì AMZN: 50 hourly bars cached
  ‚úì GM: 50 hourly bars cached
  ‚úì NFLX: 50 hourly bars cached
  ‚úì PINS: 50 hourly bars cached
  ‚úì GME: 50 hourly bars cached
  ‚úì C: 50 hourly bars cached
  ‚úì QCOM: 50 hourly bars cached
  ‚úì CVX: 50 hourly bars cached
  ‚úì WFC: 50 hourly bars cached
  ‚úì JPM: 50 hourly bars cached
  ‚úì MS: 50 hourly bars cached
  ‚úì OXY: 50 hourly bars cached
  ‚úì BAC: 50 hourly bars cached
  ‚úì BABA: 50 hourly bars cached
  ‚úì META: 50 hourly bars cached
  ‚úì MSFT: 50 hourly bars cached
‚úì Cached hourly bars for 52/52 stocks

  ‚úì Loading from cache: TSLA_20250915_5sec.json
  ‚úì Loading from cache: LYFT_20250915_5sec.json
  ‚úì Loading from cache: JD_20250915_5sec.json
  ‚úì Loading from cache: MU_20250915_5sec.json
  ‚úì Loading from cache: ARM_20250915_5sec.json
  ‚úì Loading from cache: BIDU_20250915_5sec.json
  ‚úì Loading from cache: HOOD_20250915_5sec.json
  ‚úì Loading from cache: LCID_20250915_5sec.json
  ‚úì Loading from cache: RIVN_20250915_5sec.json
  ‚úì Loading from cache: CLOV_20250915_5sec.json
  ‚úì Loading from cache: NIO_20250915_5sec.json
  ‚úì Loading from cache: COIN_20250915_5sec.json
  ‚úì Loading from cache: BA_20250915_5sec.json
  ‚úì Loading from cache: INTC_20250915_5sec.json
  ‚úì Loading from cache: XPEV_20250915_5sec.json
  ‚úì Loading from cache: AMD_20250915_5sec.json
  ‚úì Loading from cache: RBLX_20250915_5sec.json
  ‚úì Loading from cache: LRCX_20250915_5sec.json
  ‚úì Loading from cache: UBER_20250915_5sec.json
  ‚úì Loading from cache: ROKU_20250915_5sec.json
  ‚úì Loading from cache: NVDA_20250915_5sec.json
  ‚úì Loading from cache: SOFI_20250915_5sec.json
  ‚úì Loading from cache: AVGO_20250915_5sec.json
  ‚úì Loading from cache: GS_20250915_5sec.json
  ‚úì Loading from cache: BB_20250915_5sec.json
  ‚úì Loading from cache: AAPL_20250915_5sec.json
  ‚úì Loading from cache: SNAP_20250915_5sec.json
  ‚úì Loading from cache: GOOGL_20250915_5sec.json
  ‚úì Loading from cache: XOM_20250915_5sec.json
  ‚úì Loading from cache: AMC_20250915_5sec.json
  ‚úì Loading from cache: LI_20250915_5sec.json
  ‚úì Loading from cache: BBBY_20250915_5sec.json
  ‚úì Loading from cache: DIS_20250915_5sec.json
  ‚úì Loading from cache: F_20250915_5sec.json
  ‚úì Loading from cache: PYPL_20250915_5sec.json
  ‚úì Loading from cache: AMAT_20250915_5sec.json
  ‚úì Loading from cache: AMZN_20250915_5sec.json
  ‚úì Loading from cache: GM_20250915_5sec.json
  ‚úì Loading from cache: NFLX_20250915_5sec.json
  ‚úì Loading from cache: PINS_20250915_5sec.json
  ‚úì Loading from cache: GME_20250915_5sec.json
  ‚úì Loading from cache: C_20250915_5sec.json
  ‚úì Loading from cache: QCOM_20250915_5sec.json
  ‚úì Loading from cache: CVX_20250915_5sec.json
  ‚úì Loading from cache: WFC_20250915_5sec.json
  ‚úì Loading from cache: JPM_20250915_5sec.json
  ‚úì Loading from cache: MS_20250915_5sec.json
  ‚úì Loading from cache: OXY_20250915_5sec.json
  ‚úì Loading from cache: BAC_20250915_5sec.json
  ‚úì Loading from cache: BABA_20250915_5sec.json
  ‚úì Loading from cache: META_20250915_5sec.json
  ‚úì Loading from cache: MSFT_20250915_5sec.json

[TSLA] Testing setup...
  Resistance: $396.69 | Support: $389.43
  Score: 110 | R/R: 1.37:1
  ‚úì Fetched 4680 5-second bars
  üìä Overnight gap: +6.99% ‚Üí Now 6.26% from pivot
[DELAYED MOMENTUM] TSLA Bar 203 (candle #16) - 0.51x vol (need 2.0x), 0.06% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 215 (candle #17) - 0.71x vol (need 2.0x), 0.47% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 227 (candle #18) - 0.78x vol (need 2.0x), 0.06% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 239 (candle #19) - 0.44x vol (need 2.0x), 0.19% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 251 (candle #20) - 0.60x vol (need 2.0x), 0.11% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 263 (candle #21) - 0.83x vol (need 2.0x), 0.45% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 275 (candle #22) - 0.85x vol (need 2.0x), 0.12% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 287 (candle #23) - 0.76x vol (need 2.0x), 0.11% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 299 (candle #24) - 0.51x vol (need 2.0x), 0.07% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 311 (candle #25) - 0.75x vol (need 2.0x), 0.15% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 323 (candle #26) - 0.45x vol (need 2.0x), 0.05% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 335 (candle #27) - 0.53x vol (need 2.0x), 0.16% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 347 (candle #28) - 0.47x vol (need 2.0x), 0.03% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 359 (candle #29) - 0.61x vol (need 2.0x), 0.20% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 371 (candle #30) - 0.84x vol (need 2.0x), 0.30% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 383 (candle #31) - 0.68x vol (need 2.0x), 0.24% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 395 (candle #32) - 0.60x vol (need 2.0x), 0.43% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 407 (candle #33) - 0.64x vol (need 2.0x), 0.05% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 419 (candle #34) - 0.49x vol (need 2.0x), 0.04% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 431 (candle #35) - 0.46x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 443 (candle #36) - 0.60x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 455 (candle #37) - 1.44x vol (need 2.0x), 0.63% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 467 (candle #38) - 1.68x vol (need 2.0x), 0.08% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 479 (candle #39) - 1.10x vol (need 2.0x), 0.02% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 491 (candle #40) - 0.85x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 503 (candle #41) - 0.67x vol (need 2.0x), 0.02% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 515 (candle #42) - 0.82x vol (need 2.0x), 0.15% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 527 (candle #43) - 0.99x vol (need 2.0x), 0.35% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 539 (candle #44) - 0.89x vol (need 2.0x), 0.19% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 551 (candle #45) - 0.81x vol (need 2.0x), 0.12% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 563 (candle #46) - 0.95x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 575 (candle #47) - 0.80x vol (need 2.0x), 0.08% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 587 (candle #48) - 0.89x vol (need 2.0x), 0.25% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 599 (candle #49) - 1.42x vol (need 2.0x), 0.22% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 611 (candle #50) - 1.04x vol (need 2.0x), 0.23% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 623 (candle #51) - 1.00x vol (need 2.0x), 0.24% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 635 (candle #52) - 1.19x vol (need 2.0x), 0.14% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 647 (candle #53) - 0.86x vol (need 2.0x), 0.07% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 659 (candle #54) - 1.19x vol (need 2.0x), 0.23% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 671 (candle #55) - 0.92x vol (need 2.0x), 0.27% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 683 (candle #56) - 1.03x vol (need 2.0x), 0.21% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 695 (candle #57) - 0.81x vol (need 2.0x), 0.20% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 707 (candle #58) - 1.59x vol (need 2.0x), 0.10% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 719 (candle #59) - 1.10x vol (need 2.0x), 0.16% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 731 (candle #60) - 1.60x vol (need 2.0x), 0.12% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 743 (candle #61) - 0.68x vol (need 2.0x), 0.01% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 755 (candle #62) - 0.66x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 767 (candle #63) - 0.59x vol (need 2.0x), 0.07% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 779 (candle #64) - 0.77x vol (need 2.0x), 0.25% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 803 (candle #66) - 0.50x vol (need 2.0x), 0.10% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 815 (candle #67) - 0.57x vol (need 2.0x), 0.04% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 827 (candle #68) - 0.40x vol (need 2.0x), 0.06% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 839 (candle #69) - 0.66x vol (need 2.0x), 0.25% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 851 (candle #70) - 0.87x vol (need 2.0x), 0.02% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 863 (candle #71) - 0.48x vol (need 2.0x), 0.18% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 875 (candle #72) - 0.54x vol (need 2.0x), 0.01% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 887 (candle #73) - 0.52x vol (need 2.0x), 0.04% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 899 (candle #74) - 1.19x vol (need 2.0x), 0.24% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 911 (candle #75) - 0.69x vol (need 2.0x), 0.05% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 923 (candle #76) - 0.64x vol (need 2.0x), 0.03% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 935 (candle #77) - 0.46x vol (need 2.0x), 0.01% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 947 (candle #78) - 0.57x vol (need 2.0x), 0.08% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 959 (candle #79) - 0.60x vol (need 2.0x), 0.00% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 971 (candle #80) - 1.10x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 983 (candle #81) - 0.91x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 995 (candle #82) - 1.08x vol (need 2.0x), 0.06% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1007 (candle #83) - 1.60x vol (need 2.0x), 0.15% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1019 (candle #84) - 1.25x vol (need 2.0x), 0.05% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1031 (candle #85) - 1.59x vol (need 2.0x), 0.10% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1043 (candle #86) - 1.33x vol (need 2.0x), 0.00% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1055 (candle #87) - 0.97x vol (need 2.0x), 0.07% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1067 (candle #88) - 0.96x vol (need 2.0x), 0.00% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1079 (candle #89) - 1.42x vol (need 2.0x), 0.18% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1091 (candle #90) - 0.95x vol (need 2.0x), 0.03% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1103 (candle #91) - 1.40x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1115 (candle #92) - 1.19x vol (need 2.0x), 0.07% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1127 (candle #93) - 0.87x vol (need 2.0x), 0.03% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1139 (candle #94) - 0.86x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1151 (candle #95) - 1.64x vol (need 2.0x), 0.46% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1163 (candle #96) - 1.27x vol (need 2.0x), 0.02% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1175 (candle #97) - 0.92x vol (need 2.0x), 0.07% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1187 (candle #98) - 0.73x vol (need 2.0x), 0.08% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1199 (candle #99) - 0.52x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1211 (candle #100) - 0.88x vol (need 2.0x), 0.01% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1223 (candle #101) - 0.92x vol (need 2.0x), 0.11% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1235 (candle #102) - 0.69x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1247 (candle #103) - 0.74x vol (need 2.0x), 0.10% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1259 (candle #104) - 0.78x vol (need 2.0x), 0.07% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1271 (candle #105) - 0.74x vol (need 2.0x), 0.01% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1283 (candle #106) - 0.63x vol (need 2.0x), 0.09% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1295 (candle #107) - 0.84x vol (need 2.0x), 0.11% candle (need 0.0%)
[DELAYED MOMENTUM] TSLA Bar 1307 (candle #108) - 2.24x vol (need 2.0x), 0.39% candle (need 0.0%)
[MOMENTUM FOUND!] TSLA Bar 1307 - Checking filters...

‚úì Disconnected from IBKR
Traceback (most recent call last):
  File "/Users/karthik/projects/DayTrader/trader/backtest/backtester.py", line 1026, in <module>
    main()
  File "/Users/karthik/projects/DayTrader/trader/backtest/backtester.py", line 1022, in main
    backtester.run()
  File "/Users/karthik/projects/DayTrader/trader/backtest/backtester.py", line 239, in run
    self.backtest_day()
  File "/Users/karthik/projects/DayTrader/trader/backtest/backtester.py", line 320, in backtest_day
    self.backtest_stock(stock)
  File "/Users/karthik/projects/DayTrader/trader/backtest/backtester.py", line 466, in backtest_stock
    confirmed, confirm_reason, entry_state = self.strategy.check_hybrid_entry(
  File "/Users/karthik/projects/DayTrader/trader/strategy/ps60_strategy.py", line 1007, in check_hybrid_entry
    return check_entry_state_machine(
  File "/Users/karthik/projects/DayTrader/trader/strategy/ps60_entry_state_machine.py", line 197, in check_entry_state_machine
    insufficient_room, room_reason = strategy._check_room_to_run(current_price, target_price, side)
  File "/Users/karthik/projects/DayTrader/trader/strategy/ps60_strategy.py", line 1476, in _check_room_to_run
    self.logger.debug(f"  [Room-to-Run] {side}: entry=${current_price:.2f}, target=${target_price:.2f}, room={room_pct:.2f}%, threshold={self.min_room_to_target_pct:.1f}%")
AttributeError: 'PS60Strategy' object has no attribute 'logger'
